<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ラノベ新刊棚（テスト）</title>
  <style>
    /* 余白極小で「棚」を1画面に寄せる */
    html, body { margin: 0; padding: 0; background:#fff; }
    body { font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif; }

    .wrap { padding: 10px 10px 12px; }
    .bar { display:flex; align-items: baseline; justify-content: space-between; gap: 10px; margin: 0 0 8px; }
    .bar h1 { font-size: 15px; margin: 0; font-weight: 900; }
    .bar button {
      font-size: 12px; border: 1px solid #e5e5e5; background:#fff; padding: 6px 10px;
      border-radius: 999px; cursor: pointer;
    }

    /* 棚：3列固定。段数は表示件数で決まる */
    .shelf {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    /* 表紙＋小さなボタンだけ */
    .item { display:flex; flex-direction: column; gap: 6px; }
    .cover {
      border: 1px solid #eee;
      border-radius: 10px;
      overflow: hidden;
      background:#f6f6f6;
      aspect-ratio: 2 / 3; /* 縦長表紙 */
      display:grid;
      place-items:center;
    }
    .cover img { width: 100%; height: 100%; object-fit: cover; display:block; }

    .btn {
      display:block;
      text-align:center;
      font-size: 12px;
      text-decoration:none;
      border: 1px solid #e5e5e5;
      border-radius: 10px;
      padding: 6px 0;
      line-height: 1;
    }

    /* タイトルは棚では無し（必要なら後で1行だけ追加できる） */

    /* iPhone SE級でも詰まりすぎないよう微調整 */
    @media (max-width: 360px) {
      .wrap { padding: 8px; }
      .shelf { gap: 6px; }
      .btn { font-size: 11px; padding: 6px 0; }
      .bar h1 { font-size: 14px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1>ラノベ新刊一覧（テスト中）</h1>
      <button id="moreBtn" type="button">もっと見る</button>
    </div>

    <div class="shelf" id="shelf"></div>
  </div>

<script>
  // ★あなたのAmazon追跡ID（例: "mozu-22"）に変更
  const AMAZON_TAG = "mozublo-22";

  function amazonUrlFromIsbn(isbn) {
    const q = encodeURIComponent(isbn);
    return `https://www.amazon.co.jp/s?k=${q}&tag=${encodeURIComponent(AMAZON_TAG)}`;
  }

  // ダミー（本番はopenBDで cover/title/author/date/isbn を埋める）
  const items = [
    { isbn:"9784040000001", cover:"https://placehold.co/600x900?text=1" },
    { isbn:"9784040000002", cover:"https://placehold.co/600x900?text=2" },
    { isbn:"9784040000003", cover:"https://placehold.co/600x900?text=3" },
    { isbn:"9784040000004", cover:"https://placehold.co/600x900?text=4" },
    { isbn:"9784040000005", cover:"https://placehold.co/600x900?text=5" },
    { isbn:"9784040000006", cover:"https://placehold.co/600x900?text=6" },
    { isbn:"9784040000007", cover:"https://placehold.co/600x900?text=7" },
    { isbn:"9784040000008", cover:"https://placehold.co/600x900?text=8" },
    { isbn:"9784040000009", cover:"https://placehold.co/600x900?text=9" },
    { isbn:"9784040000010", cover:"https://placehold.co/600x900?text=10" },
  ];

  const shelf = document.getElementById("shelf");
  const moreBtn = document.getElementById("moreBtn");

  let expanded = false;

  function render() {
    shelf.innerHTML = "";
    const visibleCount = expanded ? 9 : 6; // 2段(6冊)→最大3段(9冊)
    const show = items.slice(0, visibleCount);

    show.forEach(x => {
      const aUrl = amazonUrlFromIsbn(x.isbn);
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div class="cover"><img src="${x.cover}" alt=""></div>
        <a class="btn" href="${aUrl}" target="_blank" rel="nofollow noopener">Amazon</a>
      `;
      shelf.appendChild(el);
    });

    moreBtn.textContent = expanded ? "たたむ" : "もっと見る";
  }

  moreBtn.addEventListener("click", () => {
    expanded = !expanded;
    render();
  });

  render();
</script>
</body>
</html>
